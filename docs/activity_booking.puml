@startuml

' ========== THESIS STANDARD CONFIGURATION ==========
skinparam handwritten false
skinparam shadowing false
skinparam monochrome true
skinparam defaultFontName Arial
skinparam defaultFontSize 11

skinparam activity {
    StartColor Black
    EndColor Black
    BackgroundColor White
    BorderColor Black
    ArrowColor Black
    DiamondBorderColor Black
    DiamondBackgroundColor White
}

skinparam swimlane {
    BorderColor Black
    TitleBackgroundColor White
    TitleFontColor Black
}

title Activity Diagram: Quy trình đặt lịch hẹn khám nha khoa

|Bệnh nhân|
start
:Truy cập trang đặt lịch;
:Chọn phòng khám;
:Xem danh sách dịch vụ nha khoa;
:Chọn dịch vụ cần khám;
:Xem danh sách nha sĩ;
:Chọn nha sĩ;
:Chọn ngày khám;

|Hệ thống|
:Truy vấn lịch làm việc của nha sĩ;
:Truy vấn các slot đã được đặt;
:Tính toán các slot còn trống;
:Trả về danh sách slot trống;

|Bệnh nhân|
:Chọn khung giờ mong muốn;
:Nhập thông tin cá nhân;
:Xác nhận đặt lịch;

|Hệ thống|
:Kiểm tra lịch nghỉ của nha sĩ;

if (Nha sĩ nghỉ?) then ([Có])
    :Thông báo nha sĩ không làm việc;
    |Bệnh nhân|
    :Chọn nha sĩ/ngày khác;
    detach
else ([Không])
endif

:Kiểm tra trùng lịch;

if (Slot đã bị đặt?) then ([Có])
    :Thông báo slot đã có người đặt;
    |Bệnh nhân|
    :Chọn slot khác;
    detach
else ([Không])
endif

:Tạo lịch hẹn mới (Pending);
:Tạo token xác nhận và hủy lịch;

|Email Service|
:Gửi email xác nhận đến bệnh nhân;

|Bệnh nhân|
:Nhận email xác nhận;
:Click link xác nhận;

|Hệ thống|
:Xác thực token;

if (Token hợp lệ?) then ([Có])
    :Cập nhật trạng thái: Confirmed;
    :Tạo hồ sơ bệnh nhân (nếu mới);
    :Tạo tài khoản người dùng (nếu mới);
    |Email Service|
    :Gửi email thông báo lịch hẹn đã xác nhận;
    |Bệnh nhân|
    :Hoàn tất đặt lịch;
    stop
else ([Không])
    :Thông báo token không hợp lệ;
    stop
endif

@enduml
