@startuml

' ========== THESIS STANDARD CONFIGURATION ==========
skinparam handwritten false
skinparam shadowing false
skinparam monochrome true
skinparam defaultFontName Arial
skinparam defaultFontSize 11

skinparam activity {
    StartColor Black
    EndColor Black
    BackgroundColor White
    BorderColor Black
    ArrowColor Black
    DiamondBorderColor Black
    DiamondBackgroundColor White
}

skinparam swimlane {
    BorderColor Black
    TitleBackgroundColor White
    TitleFontColor Black
}

title Activity Diagram: Quy trình hủy lịch hẹn

|Bệnh nhân|
start
:Nhận email xác nhận lịch hẹn;
:Click link hủy lịch trong email;

|Hệ thống|
:Nhận yêu cầu hủy lịch;
:Xác thực Cancel Token;

if (Token hợp lệ?) then ([Có])
    :Truy vấn thông tin lịch hẹn;
    
    if (Lịch hẹn tồn tại?) then ([Có])
        :Kiểm tra thời gian còn lại;
        
        if (Còn >= 2 giờ trước lịch hẹn?) then ([Có])
            :Cập nhật trạng thái: Cancelled;
            :Vô hiệu hóa token đã sử dụng;
            :Giải phóng slot cho người khác đặt;
            
            |Email Service|
            :Gửi email xác nhận đã hủy lịch;
            
            |Bệnh nhân|
            :Nhận thông báo hủy thành công;
            :Có thể đặt lịch mới;
            stop
            
        else ([Không])
            :Từ chối yêu cầu hủy;
            :Thông báo: Không thể hủy\ntrong vòng 2 giờ trước lịch hẹn;
            
            |Bệnh nhân|
            :Nhận thông báo từ chối;
            :Liên hệ phòng khám nếu cần;
            stop
        endif
        
    else ([Không])
        :Thông báo: Lịch hẹn không tồn tại;
        stop
    endif
    
else ([Không])
    :Thông báo: Link không hợp lệ\nhoặc đã hết hạn;
    
    |Bệnh nhân|
    :Liên hệ phòng khám để được hỗ trợ;
    stop
endif

@enduml
